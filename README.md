# DevFlow Hub: Centralized CI/CD Consolidation (30+ Projects)

**CLASSIFICATION:** INTERNAL - PROPRIETARY  
**STRATEGY:** GitHub-to-GitLab CI/CD Integration  
**OBJECTIVE:** Cost Reduction & Performance Optimization  

---

## 1. Бизнес-кейс: Почему мы уходим от GitHub Actions?

При масштабе **30+ проектов** модель оплаты "за репозиторий/минуту" становится экономически неэффективной. 

| Параметр | GitHub Actions (Cloud) | DevFlow Hub (GitLab CI + Managed K8s) |
| :--- | :--- | :--- |
| **Стоимость** | Растет линейно с каждым проектом и минутой. | Фиксированная стоимость ядра + оплата за реальное железо. |
| **Контроль** | Ограничен лимитами GitHub. | Полный контроль над мощностью CPU/RAM. |
| **Кэширование** | Медленное (через интернет). | Сверхбыстрое (локальный S3/MinIO). |
| **Безопасность** | Секреты разбросаны по 30 репозиториям. | Централизованное хранение (Vault/GitLab Variables). |

**Экономический эффект:** Снижение затрат на CI/CD инфраструктуру на **60-75%** при сохранении GitHub как хранилища кода.

---

## 2. Архитектура "Centralized Engine"

Система работает по принципу **"CI/CD Mirroring"**. Исходный код остается на GitHub, но все вычислительные задачи (Build, Test, Deploy) мгновенно переносятся в наш закрытый контур.

### 2.1. Control Plane (Центр Управления)
*   **GitLab Instance (Self-Managed):** Единая точка входа для всех 30 проектов. Подключается к GitHub через "CI/CD for External Repositories".
*   **Database:** PostgreSQL HA — обслуживает очереди задач всех команд.
*   **Registry:** Единое хранилище Docker-образов и артефактов для всех 30 сервисов.

### 2.2. Execution Plane (Общий пул ресурсов)
Вместо того чтобы покупать 30 отдельных серверов, мы создаем **единый масштабируемый кластер**:

*   **Managed Kubernetes (Execution Fleet):** Использует технологию автоматического масштабирования. Если работают только 5 проектов из 30 — кластер сжимается. Если идет релиз всех 30 одновременно — кластер расширяется.
*   **Spot Instances:** Использование прерываемых облачных мощностей (Spot/Preemptible) снижает стоимость вычислений в 4 раза по сравнению со стандартными тарифами GitHub.

---

## 3. Техническая реализация (Stack)

Система оптимизирована под современные веб-технологии, используемые в ваших 30 проектах:

*   **Frontend/Backend:** TSX, TypeScript, Node.js.
*   **Automation:** Python-скрипты для сложной оркестрации.
*   **Infrastructure:** Terraform (для управления K8s кластером), Ansible (для настройки окружений).
*   **Caching:** Глобальный MinIO кластер. Кэш `node_modules` для всех 30 проектов хранится "рядом" с раннерами, что сокращает время сборки с 10 минут до 2-3 минут.

---

## 4. Сценарий работы (Workflow)

1.  Разработчик делает `push` в **GitHub**.
2.  GitHub через Webhook уведомляет **GitLab**.
3.  **GitLab CI** запрашивает ресурсы у нашего **Managed K8s**.
4.  В облаке мгновенно поднимается Runner, скачивает код из GitHub, забирает кэш из MinIO.
5.  Происходит сборка (TypeScript) и тестирование (Python/Jest).
6.  Результат (Статус/Logs) отправляется обратно в интерфейс GitHub.
7.  **Runner уничтожается**, прекращая потребление платных ресурсов.

---

## 5. Итог: Цена-Качество

*   **Качество:** Вы получаете уровень Enterprise CI/CD (как у Google/Uber) с глубокой аналитикой и безопасностью.
*   **Цена:** Вы платите только за реальное время работы процессора, без переплат за лицензии GitHub Actions для каждого отдельного репозитория. 

**DevFlow Hub — это переход от "аренды инструментов" к "владению фабрикой разработки".**
